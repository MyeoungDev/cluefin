# ML 예측 모델 Precision, Recall, F1-Score 개선 작업

## 문제 상황
`--ml-predict` 옵션 사용 시 precision, recall, f1-score가 항상 0.0으로 출력되는 문제 발생

## 지표 설명 (한글)

### Precision (정밀도)
- **의미**: 모델이 "상승"이라고 예측한 것 중 실제로 상승한 비율
- **공식**: True Positive / (True Positive + False Positive)
- **0.0의 의미**: 상승 예측이 모두 틀렸다는 의미 (False Positive만 존재)

### Recall (재현율/민감도)
- **의미**: 실제로 상승한 것 중에서 모델이 올바르게 "상승"이라고 예측한 비율  
- **공식**: True Positive / (True Positive + False Negative)
- **0.0의 의미**: 실제 상승을 하나도 감지하지 못했다는 의미 (True Positive가 0)

### F1-Score
- **의미**: Precision과 Recall의 조화평균으로 균형 잡힌 성능 지표
- **공식**: 2 × (Precision × Recall) / (Precision + Recall)
- **0.0의 의미**: Precision과 Recall 중 하나라도 0이면 F1-Score도 0

## 주요 문제 원인 분석

1. **타겟 변수 생성 문제**
   - `create_target_variable()`에서 생성되는 이진 분류 타겟의 불균형
   - 모든 예측이 한 클래스로 편향될 가능성

2. **데이터 부족 문제**  
   - 2개 종목만으로는 학습에 충분하지 않음
   - 최소 30일 데이터도 패턴 학습에 부족할 수 있음

3. **특성 엔지니어링 문제**
   - NaN 값 처리 불완전
   - 특성 간 스케일 차이로 인한 학습 방해
   - 무관한 특성들이 노이즈 생성

4. **모델 파라미터 문제**
   - LightGBM 기본 파라미터가 이 데이터셋에 부적합
   - 클래스 불균형에 대한 가중치 미적용

5. **검증 데이터 분할 문제**
   - 시계열 특성을 무시한 랜덤 분할
   - 미래 데이터로 과거 예측하는 데이터 누수

## 개선 작업 목록

### 1. 진단 및 데이터 품질 개선
- [x] 1.1 타겟 변수 분포 분석 도구 구현
- [x] 1.2 특성별 NaN/무한값/이상치 검출 기능
- [ ] 1.3 데이터 품질 리포트 생성 기능
- [ ] 1.4 클래스 불균형 시각화 기능

### 2. 타겟 변수 생성 로직 개선  
- [ ] 2.1 다양한 타겟 생성 방법 구현 (% 임계값 기반)
- [ ] 2.2 SMOTE를 이용한 오버샘플링 구현
- [ ] 2.3 클래스 가중치 자동 조정 기능
- [ ] 2.4 다중 예측 기간 지원 (1일/3일/5일)

### 3. 특성 엔지니어링 강화
- [ ] 3.1 Robust Scaler 적용으로 이상치 영향 최소화
- [ ] 3.2 상관관계 분석으로 중복 특성 제거
- [ ] 3.3 특성 중요도 기반 특성 선택
- [ ] 3.4 추가 기술적 지표 구현 (Ichimoku, Fibonacci 등)

### 4. 모델 최적화
- [ ] 4.1 Optuna를 이용한 하이퍼파라미터 자동 튜닝
- [ ] 4.2 Time Series Split을 이용한 교차 검증
- [ ] 4.3 조기 종료 조건 최적화
- [ ] 4.4 앙상블 모델 구현 (RandomForest + XGBoost + LightGBM)

### 5. 모니터링 및 디버깅
- [ ] 5.1 학습 과정 상세 로깅 추가
- [ ] 5.2 혼동 행렬(Confusion Matrix) 시각화
- [ ] 5.3 특성 중요도 시각화
- [ ] 5.4 예측 확률 분포 분석 도구
- [ ] 5.5 디버그 모드에서 중간 결과 저장

### 6. 예측 신뢰성 향상
- [ ] 6.1 예측 불확실성 정량화
- [ ] 6.2 모델 성능 실시간 모니터링
- [ ] 6.3 백테스팅 프레임워크 구현
- [ ] 6.4 경고 시스템 (낮은 성능 감지)

## 예상 효과

이 개선 작업을 통해:
1. **Precision > 0.6**: 상승 예측의 60% 이상이 정확
2. **Recall > 0.5**: 실제 상승의 50% 이상을 감지  
3. **F1-Score > 0.55**: 균형 잡힌 성능 지표 달성
4. **전반적 모델 신뢰성 향상**: 실용적인 투자 보조 도구로 활용 가능

## 우선순위

**Phase 1 (긴급)**: 1.1, 1.2, 2.1, 2.2, 5.1
**Phase 2 (중요)**: 3.1, 3.2, 4.1, 4.2, 5.2  
**Phase 3 (개선)**: 3.4, 4.4, 6.1, 6.3

각 작업은 독립적으로 구현 가능하며, Phase 1 완료만으로도 상당한 성능 개선을 기대할 수 있습니다.